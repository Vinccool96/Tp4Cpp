/**
 * \file Bibliographie.cpp
 * \brief Implémentation de la classe Bibliographie
 * \author etudiant
 * \version 1.0
 * \date 2019-04-10
 */
#include "Bibliographie.h"
#include "ContratException.h"

#include <sstream>
#include <vector>

namespace biblio
{

	/**
	 * \brief crée un instance de Bibliographie
	 * \param[in] p_nom le nom de le bibliographie
	 * \pre p_nom n'est pas vide
	 * \post m_nom prend la valeur de p_nom
	 * \post m_vReferences est vide
	 */
	Bibliographie::Bibliographie(const std::string& p_nom) :
			m_nom(p_nom)
	{
		PRECONDITION(!(p_nom.empty()));

		POSTCONDITION(m_nom == p_nom);
		POSTCONDITION(m_vReferences.empty());
	}

	Bibliographie::~Bibliographie()
	{
		m_vReferences.clear();
		std::vector<Reference*>(m_vReferences).swap(m_vReferences);
	}

	void Bibliographie::ajouterReference(const Reference& p_nouvelleReference)
	{
		Reference* clone = p_nouvelleReference.clone();
		m_vReferences.push_back(clone);
	}

	/**
	 * La représentation textuelle de la bibliographie
	 * \return un string sous la forme "m_auteur. m_titre. m_nom, vol. m_volume, no. m_numero, pp. m_page,
	 * 			m_annee. m_iditenfiant."
	 */
	std::string Bibliographie::reqBibliographieFormate() const
	{
		std::ostringstream oss;
		oss << reqNom() << "\n" << "===============================\n";
		for (unsigned int i = 0; i < m_vReferences.size(); i++)
		{
			oss << "[" << i << "] " << m_vReferences[i]->reqReferenceFormate()
			        << "\n";
		}
		return oss.str();
	}

	bool Bibliographie::referenceEstDejaPresente(
	        const std::string& p_identifiant) const
	{
		bool resultat = false;
		for (Reference* ref : m_vReferences)
		{
			if (p_identifiant == ref->reqIdentifiant())
			{
				resultat = true;
				break;
			}
		}
		return resultat;
	}

	/**
	 * Retourne le nom de la bibliographie
	 * \return le string du nom
	 */
	const std::string& Bibliographie::reqNom() const
	{
		return m_nom;
	}

	/**
	 * \brief Vérifie les invariants de la classe
	 */
	void Bibliographie::verifieInvariant() const
	{
		INVARIANT(!(m_nom.empty()));
	}

}  // namespace biblio
